/**
 * AEGIS Protocol Configuration - Post Style
 *
 * @version 3.5 Unified
 */

module.exports = {
  //===========================================================================
  // 프로젝트 기본 정보
  //===========================================================================
  project: {
    name: 'post-style',
    type: 'monorepo', // monorepo with app (frontend) and server (backend)
    packageManager: 'pnpm',
    version: '3.5', // AEGIS Protocol version
  },

  //===========================================================================
  // 모노레포 구조
  //===========================================================================
  packages: {
    frontend: {
      path: 'app',
      port: 3000,
      framework: 'react-vite',
      buildCommand: 'pnpm build',
      devCommand: 'pnpm dev',
      typeCheckCommand: 'pnpm tsc --noEmit',
      lintCommand: 'pnpm lint',
    },
    backend: {
      path: 'server',
      port: 8787,
      framework: 'hono',
      buildCommand: 'pnpm build',
      devCommand: 'pnpm dev',
      typeCheckCommand: 'pnpm tsc --noEmit',
    },
  },

  //===========================================================================
  // 서버 정보 (배포용 - 추후 설정)
  //===========================================================================
  server: {
    ip: '', // 배포 시 설정
    user: '',
    path: '',
    sshKey: '~/.ssh/id_rsa',
  },

  //===========================================================================
  // 데이터베이스 설정
  //===========================================================================
  database: {
    type: 'sqlite',
    path: 'server/data/local.db',

    // 스키마 검증용 중요 테이블 (Layer 0)
    criticalTables: [
      'users',
      'contents',
      'style_profiles',
      'channels',
      'competitor_analyses',
      'content_performance',
      'keyword_rankings',
      'seo_audits',
      'user_activity_logs',
      'page_views',
    ],
  },

  //===========================================================================
  // 검증 설정 (7-Layer)
  //===========================================================================
  validation: {
    // Layer 1: Static Analysis
    buildCommands: {
      frontend: 'cd app && pnpm build',
      backend: 'cd server && pnpm build',
    },
    typeCheckCommands: {
      frontend: 'cd app && pnpm tsc --noEmit',
      backend: 'cd server && pnpm tsc --noEmit',
    },
    lintCommands: {
      frontend: 'cd app && pnpm lint',
    },

    // Layer 2: Unit Test
    unitTestCommand: 'pnpm test',

    // Layer 3: Integration Test
    integrationTestCommand: 'pnpm test:integration',

    // Layer 4: E2E Test
    e2eTestTool: 'chrome-mcp', // 또는 'playwright-mcp'
    e2eBaseUrl: 'http://localhost:3000',

    // Layer 5: Staging (추후 설정)
    stagingUrl: '',

    // Layer 6: Production (추후 설정)
    productionUrl: '',
    healthCheckEndpoint: '/api/health',
  },

  //===========================================================================
  // Automation Layer (v3.5 신규)
  //===========================================================================
  automation: {
    // Feedback Loop 설정
    feedbackLoop: {
      enabled: true,
      maxRetries: 3, // 최대 재시도 횟수
      commands: [
        'cd app && pnpm build',
        'cd server && pnpm build',
        'pnpm lint',
        'pnpm test',
      ],
    },

    // Infinite Loop (Ralph Wiggum 모드) 설정
    infiniteLoop: {
      enabled: true,
      maxIterations: 10, // 최대 반복 횟수
      breakOnSuccess: true, // 성공 시 중단
    },
  },

  //===========================================================================
  // 병렬 실행 설정 (v3.5 신규)
  //===========================================================================
  parallelExecution: {
    maxClaudes: 5, // 최대 동시 실행 Claude 수
    workAreas: {
      claude1: ['server/src/routes/', 'server/src/services/'],
      claude2: ['app/src/components/', 'app/src/pages/'],
      claude3: ['app/src/stores/', 'app/src/hooks/'],
      claude4: ['__tests__/', '.0/'],
      claude5: ['*'], // 버그 수정 - 특정 이슈에 집중
    },
    conflictPrevention: {
      buildResponsible: 'claude4', // 빌드 담당
      gitCommitSequential: true, // Git 커밋 순차 실행
    },
  },

  //===========================================================================
  // 백업 설정
  //===========================================================================
  backup: {
    directory: 'backups',
    retentionDays: 7,
    compress: true,
    exclude: [
      'node_modules',
      '.next',
      'dist',
      '.git',
      'logs',
      '.playwright-mcp',
    ],
  },

  //===========================================================================
  // 알림 설정 (선택)
  //===========================================================================
  notifications: {
    slack: {
      enabled: false,
      webhookUrl: '',
      channel: '#deployments',
    },
    discord: {
      enabled: false,
      webhookUrl: '',
    },
  },

  //===========================================================================
  // 환경별 설정
  //===========================================================================
  environments: {
    development: {
      frontendPort: 3000,
      backendPort: 8787,
      debug: true,
    },
    staging: {
      frontendPort: 3000,
      backendPort: 8787,
      debug: true,
    },
    production: {
      frontendPort: 3000,
      backendPort: 8787,
      debug: false,
    },
  },

  //===========================================================================
  // 테스트 계정 (개발/테스트용)
  //===========================================================================
  testAccounts: {
    master: {
      email: 'master@poststyle.com',
      role: 'master',
      // password는 환경 변수로 관리
    },
    admin: {
      email: 'admin@poststyle.com',
      role: 'admin',
    },
    user: {
      email: 'user@poststyle.com',
      role: 'user',
    },
  },

  //===========================================================================
  // 지식 베이스 경로
  //===========================================================================
  knowledgeBase: {
    path: 'mystyle',
    files: [
      'SEO_ACADEMIC_RESEARCH.md',
      'SEO_STRUCTURE_GUIDE.md',
      'YOONA_COMPLETE_GUIDE.md',
      'blog_style_analysis.md',
      'blog_style_guide_for_llm.md',
      'expression_dictionary.md',
      'yoona_persona.md',
    ],
  },

  //===========================================================================
  // 커스텀 커맨드 (v3.5 신규)
  //===========================================================================
  commands: {
    path: '.claude/commands',
    available: [
      'commit',
      'feedback-loop',
      'infinite-loop',
      'verify',
    ],
  },

  //===========================================================================
  // 커스텀 스킬 (v3.5 신규)
  //===========================================================================
  skills: {
    path: '.claude/skills',
    available: [
      'verify-app',
      'code-simplifier',
    ],
  },
};
