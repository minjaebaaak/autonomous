# AEGIS Protocol v3.1 - ìƒì„¸ ë¬¸ì„œ

> **A**utonomous **E**nhanced **G**uard & **I**nspection **S**ystem

---

## 1. ê°œìš”

AEGISëŠ” Claude Codeì™€ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ì²´ê³„ì ì¸ ê²€ì¦ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.

### í•µì‹¬ ì² í•™
- **ì•ˆì •ì ì´ê³  ìµœìƒì˜ ë°©í–¥ìœ¼ë¡œ ê°œë°œ**
- ì‹œê°„ì€ ì¶©ë¶„í•¨ - ì„±ê¸‰í•˜ê²Œ ì§„í–‰í•˜ì§€ ë§ ê²ƒ
- ì¬ë°œ ë°©ì§€ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤
- í•œ ë²ˆ ë‹¤ë£¬ ë¬¸ì œëŠ” ì¬ë°œí•˜ì§€ ì•Šë„ë¡ ì •í™•í•˜ê²Œ êµ¬ì¶•

---

## 2. ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AEGIS v3.1                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš¡ COGNITIVE LAYER                                              â”‚
â”‚     ultrathink + Sequential Thinking MCP                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ TASK LAYER                                                   â”‚
â”‚     TodoWrite                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” VALIDATION LAYERS (7-Layer)                                 â”‚
â”‚     L0: Schema    | L1: Build     | L2: Unit    | L3: API       â”‚
â”‚     L4: E2E       | L5: Staging   | L6: Monitor                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Cognitive Layer

### 3.1 ultrathink
- **ìš©ë„**: ëª¨ë“  ì‘ì—…ì— ê¸°ë³¸ ì ìš©
- **íŠ¹ì§•**: ê¹Šì€ ì‚¬ê³ , ì² ì €í•œ ë¶„ì„

### 3.2 Sequential Thinking MCP
- **ìš©ë„**: ë³µì¡í•œ ë¬¸ì œ ë¶„ì„
- **íŠ¹ì§•**: ë‹¨ê³„ë³„ ì²´ê³„ì  ì‚¬ê³ , ê°€ì„¤ ê²€ì¦

**ì‚¬ìš© ì‹œì **:
- ë³µì¡í•œ ë²„ê·¸ ë¶„ì„
- ì•„í‚¤í…ì²˜ ì„¤ê³„
- ë‹¤ë‹¨ê³„ ë¦¬íŒ©í† ë§
- ì„±ëŠ¥ ìµœì í™”

---

## 4. Task Layer

### 4.1 TodoWrite
- **ìš©ë„**: ëª¨ë“  ì‘ì—… í˜„í™© ì¶”ì 
- **ê·œì¹™**:
  - ì‘ì—… ì‹œì‘ ì‹œ `in_progress`ë¡œ ë§ˆí‚¹
  - ì™„ë£Œ ì¦‰ì‹œ `completed`ë¡œ ë§ˆí‚¹
  - ë™ì‹œì— í•˜ë‚˜ì˜ ì‘ì—…ë§Œ `in_progress`

---

## 5. Validation Layers (7-Layer)

### Layer 0: Schema Validation
- **ëª©ì **: DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ ê²€ì¦
- **ì‹œì **: ìƒˆ ì»¬ëŸ¼/í…Œì´ë¸” ì¶”ê°€ ì‹œ
- **ëª…ë ¹ì–´**: `./scripts/aegis-validate.sh --schema <table> <column>`
- **ê²€ì¦ í•­ëª©**:
  - í…Œì´ë¸” ì¡´ì¬ í™•ì¸
  - ì»¬ëŸ¼ íƒ€ì… í™•ì¸
  - Foreign Key ê´€ê³„ í™•ì¸

### Layer 1: Static Analysis
- **ëª©ì **: ë¹Œë“œ ë° íƒ€ì… ê²€ì¦
- **ì‹œì **: ì»¤ë°‹ ì „
- **ëª…ë ¹ì–´**: `./scripts/aegis-validate.sh --build`
- **ê²€ì¦ í•­ëª©**:
  - TypeScript ì»´íŒŒì¼
  - ESLint ê²€ì‚¬
  - ë¹Œë“œ ì„±ê³µ í™•ì¸

### Layer 2: Unit Test
- **ëª©ì **: ê°œë³„ í•¨ìˆ˜/ëª¨ë“ˆ í…ŒìŠ¤íŠ¸
- **ì‹œì **: ë¡œì§ ë³€ê²½ í›„
- **ëª…ë ¹ì–´**: `pnpm test`
- **ê²€ì¦ í•­ëª©**:
  - í•¨ìˆ˜ ë™ì‘ í™•ì¸
  - ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬
  - ì—ëŸ¬ í•¸ë“¤ë§

### Layer 3: Integration Test
- **ëª©ì **: API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- **ì‹œì **: API ë³€ê²½ í›„
- **ëª…ë ¹ì–´**: `./scripts/aegis-validate.sh --api`
- **ê²€ì¦ í•­ëª©**:
  - API ì‘ë‹µ í˜•ì‹
  - ì¸ì¦/ì¸ê°€
  - ì—ëŸ¬ ì‘ë‹µ

### Layer 4: E2E Test
- **ëª©ì **: ì „ì²´ ì‚¬ìš©ì íë¦„ í…ŒìŠ¤íŠ¸
- **ì‹œì **: ê¸°ëŠ¥ ì™„ì„± í›„, ë°°í¬ ì „
- **ë„êµ¬**: Playwright MCP
- **ê²€ì¦ í•­ëª©**:
  - ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤
  - UI ìƒí˜¸ì‘ìš©
  - í¬ë¡œìŠ¤ ë¸Œë¼ìš°ì €

**Layer 4-A: ë¡œì»¬ í…ŒìŠ¤íŠ¸**
```bash
# Playwright MCP ì‚¬ìš©
pkill -f "ms-playwright" || true  # ê¸°ì¡´ ì„¸ì…˜ ì •ë¦¬
# localhost:3001 í…ŒìŠ¤íŠ¸
```

**Layer 4-B: í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸**
```bash
# /chrome ë˜ëŠ” Playwright MCPë¡œ í”„ë¡œë•ì…˜ URL í…ŒìŠ¤íŠ¸
```

### Layer 5: Staging Validation
- **ëª©ì **: ìŠ¤í…Œì´ì§• í™˜ê²½ ê²€ì¦
- **ì‹œì **: í”„ë¡œë•ì…˜ ë°°í¬ ì „
- **ë°©ë²•**: ìˆ˜ë™ ê²€ì¦
- **ê²€ì¦ í•­ëª©**:
  - ìŠ¤í…Œì´ì§• ì„œë²„ ë™ì‘
  - ë°ì´í„° ë¬´ê²°ì„±
  - ì„±ëŠ¥ í™•ì¸

### Layer 6: Production Monitor
- **ëª©ì **: í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§
- **ì‹œì **: ë°°í¬ í›„
- **ëª…ë ¹ì–´**: `./scripts/aegis-validate.sh --monitor`
- **ê²€ì¦ í•­ëª©**:
  - ì—ëŸ¬ ë¡œê·¸ í™•ì¸
  - Health check
  - ì„±ëŠ¥ ë©”íŠ¸ë¦­

---

## 6. ì²´í¬ë¦¬ìŠ¤íŠ¸

### Pre-Commit
```
[ ] Layer 0: ìƒˆ DB ì»¬ëŸ¼ì´ ìˆë‹¤ë©´ ìŠ¤í‚¤ë§ˆ ê²€ì¦
[ ] Layer 1: pnpm build ì„±ê³µ
[ ] Layer 1: pnpm type-check ì„±ê³µ
```

### Pre-Deploy
```
[ ] Layer 0-4 ëª¨ë‘ í†µê³¼
[ ] git add, commit, push ì™„ë£Œ
[ ] ë³€ê²½ì‚¬í•­ ë¦¬ë·° ì™„ë£Œ
```

### Post-Deploy
```
[ ] Layer 6: pm2 logs í™•ì¸
[ ] Layer 6: ì—ëŸ¬ ì—†ìŒ í™•ì¸
[ ] Layer 4-B: í”„ë¡œë•ì…˜ E2E ê²€ì¦
[ ] ì‚¬ìš©ì ì•Œë¦¼ (í•„ìš”ì‹œ)
```

---

## 7. ëª…ë ¹ì–´ ìš”ì•½

### aegis-validate.sh
```bash
# ì „ì²´ ê²€ì¦
./scripts/aegis-validate.sh --all

# ë¹Œë“œ ê²€ì¦ (Layer 1)
./scripts/aegis-validate.sh --build

# API í…ŒìŠ¤íŠ¸ (Layer 3)
./scripts/aegis-validate.sh --api

# ìŠ¤í‚¤ë§ˆ ê²€ì¦ (Layer 0)
./scripts/aegis-validate.sh --schema <table> <column>

# ëª¨ë‹ˆí„°ë§ (Layer 6)
./scripts/aegis-validate.sh --monitor
```

### deploy.sh
```bash
# Production ë°°í¬
./scripts/deploy.sh production

# Staging ë°°í¬
./scripts/deploy.sh staging

# Dry-run
./scripts/deploy.sh production --dry-run

# ë°±ì—… ìƒëµ (ë¹„ê¶Œì¥)
./scripts/deploy.sh production --skip-backup
```

### rollback.sh
```bash
# íŠ¹ì • ë°±ì—…ìœ¼ë¡œ ë¡¤ë°±
./scripts/rollback.sh backups/20241028_211630

# Dry-run
./scripts/rollback.sh backups/20241028_211630 --dry-run
```

---

## 8. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¹Œë“œ ì‹¤íŒ¨
```bash
# ìºì‹œ ì‚­ì œ í›„ ì¬ë¹Œë“œ
rm -rf .next node_modules/.cache
pnpm build
```

### í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨
```bash
# í…ŒìŠ¤íŠ¸ ìƒì„¸ ë¡œê·¸ í™•ì¸
pnpm test -- --verbose
```

### ë°°í¬ ì‹¤íŒ¨
```bash
# ìë™ ë¡¤ë°± ì‹¤í–‰ë¨
# ìˆ˜ë™ ë¡¤ë°± í•„ìš”ì‹œ:
./scripts/rollback.sh $(ls -td backups/* | head -n 1)
```

---

## 9. ë²„ì „ íˆìŠ¤í† ë¦¬

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ì‚¬í•­ |
|------|------|----------|
| v3.1 | 2026-01-04 | pnpm ì „í™˜, corepack ì§€ì› |
| v3.0 | 2025-11-01 | 7-Layer ì²´ê³„ í™•ë¦½ |
| v2.0 | 2025-06-01 | Cognitive Layer ì¶”ê°€ |
| v1.0 | 2025-01-01 | ì´ˆê¸° ë²„ì „ |

---

**Last Updated**: 2026-01-04
**Maintainer**: Claude AI & minjaebaaak
